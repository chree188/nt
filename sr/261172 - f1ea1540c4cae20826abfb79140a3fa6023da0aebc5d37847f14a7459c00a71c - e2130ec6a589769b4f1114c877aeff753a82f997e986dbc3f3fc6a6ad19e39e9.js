"use strict";var Punch=function(text){if(text){var o=JSON.parse(text);this.tArray=o.tArray}else{this.tArray=[]}};Punch.prototype={toString:function(){return JSON.stringify(this)}};var PunchContract=function(){LocalContractStorage.defineMapProperty(this,"punchMap",{parse:function(text){return new Punch(text)},stringify:function(o){return o.toString()}})};PunchContract.prototype={init:function(){},save:function(){var from=Blockchain.transaction.from;var currentDate=new Date().Format("yyyy-MM-dd");var punch=this.punchMap.get(from);if(!punch){punch=new Punch();punch.tArray=[currentDate]}else{var lastDate=punch.tArray[punch.tArray.length-1];if(lastDate===currentDate){throw new Error("亲，您今日已经打过卡了哦～～请明天再来吧！")}punch.tArray.push(currentDate)}this.punchMap.put(from,punch)},list:function(from){if(!from){throw new Error("[from or birthDay or isRegister] Can not be empty")}if(!Blockchain.verifyAddress(from)){throw new Error("["+from+"]不是钱包地址啦，直接复制吧，千万不要手敲哦^_^")}return this.punchMap.get(from).tArray}};Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,(RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)))}}return fmt};module.exports=PunchContract;