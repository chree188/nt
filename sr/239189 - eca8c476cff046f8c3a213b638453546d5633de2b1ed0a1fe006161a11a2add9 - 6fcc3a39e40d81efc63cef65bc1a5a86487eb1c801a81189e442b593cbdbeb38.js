var TransferService=function(){LocalContractStorage.defineMapProperty(this,"_user_wallet_addr_nickname");LocalContractStorage.defineProperty(this,"_user_wallet_addr_size",null);LocalContractStorage.defineMapProperty(this,"_user_nickname_wallet_addr");LocalContractStorage.defineProperty(this,"_user_nickname_wallet_addr_size",null);LocalContractStorage.defineMapProperty(this,"_valid_nickname");LocalContractStorage.defineMapProperty(this,"_valid_wallet_addr");LocalContractStorage.defineProperty(this,
"_fee",11E6)};
TransferService.prototype={init:function(){},bindUsernicknameWallet:function(a){var b=String(Blockchain.transaction.from);if("banned"==this._valid_nickname.get(a))return{status:"-1",msg:"your username is not allowed!"};if("banned"==this._valid_wallet_addr.get(b))return{status:"-1",msg:"your wallet address is not allowed!"};b=String(Blockchain.transaction.from);if(this._user_nickname_wallet_addr.get(a))return{status:"-1",msg:"username has been taken"};if(this._user_wallet_addr_nickname.get(b))return{status:"-1",msg:"walletaddr has already a nickname"};
this._user_wallet_addr_nickname.set(b,a);this._user_nickname_wallet_addr.set(a,b);return{status:"0",msg:"user name set ok"}},checkUsernickname:function(a){var b=String(Blockchain.transaction.from);return"banned"==this._valid_nickname.get(a)?{status:"-1",msg:"your username is not allowed!"}:"banned"==this._valid_wallet_addr.get(b)?{status:"-1",msg:"your wallet address is not allowed!"}:this._user_nickname_wallet_addr.get(a)?{status:"-1",msg:"username has been taken"}:this._user_wallet_addr_nickname.get(b)?
{status:"-1",msg:"wallet address has already been registed!"}:{status:"0",msg:"valid address and nickname"}},getWalletaddrbyUsernickname:function(a){if("banned"==this._valid_wallet_addr.get(String(Blockchain.transaction.from)))return{status:"-1",msg:"your wallet address is not allowed!"};if("banned"==this._valid_nickname.get(a))return{status:"-1",msg:"your username is not allowed!"};a=this._user_nickname_wallet_addr.get(a);return"banned"==this._valid_wallet_addr.get(a)?{status:"-1",msg:"your wallet address is not allowed!"}:
{status:"0",msg:"success",addr:String(a)}},getUsernicknamebyWalletaddr:function(a){if("banned"==this._valid_wallet_addr.get(String(Blockchain.transaction.from)))return{status:"-1",msg:"your wallet address is not allowed!"};a=this._user_wallet_addr_nickname.get(a);return"banned"==this._valid_nickname.get(a)?{status:"-1",msg:"your username is not allowed!"}:{status:"0",msg:"sucess",nickname:String(a)}},transfer:function(a,b,c){b=String(Blockchain.transaction.from);c=String(Blockchain.transaction.value);
var d=new Bignumber(c),e=new Bignumber(this._fee),d=d.sub(e),e=this._user_nickname_wallet_addr.get(a);if(null!=e)return Blockchain.transfer(e,d),{status:"0",msg:"",from:b,to:a,money:c};Blockchain.transfer(b,d);return{status:"-1",msg:"username not exist!",from:b,to:a,money:c}},transferout:function(a){if("n1LTSt7eeX6t9igkfDMak8EWFXPzgoxpRSU"!=String(Blockchain.transaction.from))return{status:"-1",msg:"Permission Denied!"};Blockchain.transfer("n1LTSt7eeX6t9igkfDMak8EWFXPzgoxpRSU",a);return{status:"0",
msg:"Transfer ok",money:a}},setFees:function(a){if("n1LTSt7eeX6t9igkfDMak8EWFXPzgoxpRSU"!=String(Blockchain.transaction.from))return{status:"-1",msg:"Permission Denied!"};this._fee=a;return this._fee==a?{status:"0",msg:"fee set ok"}:{status:"-1",msg:"fee set error"}}};module.exports=TransferService;