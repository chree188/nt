"use strict";var TransferService=function(){LocalContractStorage.defineMapProperty(this,"_user_wallet_addr_nickname");LocalContractStorage.defineProperty(this,"_user_wallet_addr_size",null);LocalContractStorage.defineMapProperty(this,"_user_nickname_wallet_addr");LocalContractStorage.defineProperty(this,"_user_nickname_wallet_addr_size",null);LocalContractStorage.defineMapProperty(this,"_valid_nickname");LocalContractStorage.defineMapProperty(this,"_valid_wallet_addr");LocalContractStorage.defineProperty(this,"_fee",11000000)};TransferService.prototype={init:function(){},bindUsernicknameWallet:function(b){var a=String(Blockchain.transaction.from);if(this._valid_nickname.get(b)=="banned"){return{"status":"-1","msg":"your username is not allowed!"}}if(this._valid_wallet_addr.get(a)=="banned"){return{"status":"-1","msg":"your wallet address is not allowed!"}}var a=String(Blockchain.transaction.from);if(this._user_nickname_wallet_addr.get(b)){return{"status":"-1","msg":"username has been taken"}}else{if(this._user_wallet_addr_nickname.get(a)){return{"status":"-1","msg":"walletaddr has already a nickname"}}else{this._user_wallet_addr_nickname.set(a,b);this._user_nickname_wallet_addr.set(b,a);return{"status":"0","msg":"user name set ok"}}}return{"status":"-2","msg":"internal error!"}},checkUsernickname:function(b){var a=String(Blockchain.transaction.from);if(this._valid_nickname.get(b)=="banned"){return{"status":"-1","msg":"your username is not allowed!"}}if(this._valid_wallet_addr.get(a)=="banned"){return{"status":"-1","msg":"your wallet address is not allowed!"}}if(this._user_nickname_wallet_addr.get(b)){return{"status":"-1","msg":"username has been taken"}}else{if(this._user_wallet_addr_nickname.get(a)){return{"status":"-1","msg":"wallet address has already been registed!"}}else{return{"status":"0","msg":"valid address and nickname"}}}},getWalletaddrbyUsernickname:function(c){var b=String(Blockchain.transaction.from);if(this._valid_wallet_addr.get(b)=="banned"){return{"status":"-1","msg":"your wallet address is not allowed!"}}if(this._valid_nickname.get(c)=="banned"){return{"status":"-1","msg":"your username is not allowed!"}}var a=this._user_nickname_wallet_addr.get(c);if(this._valid_wallet_addr.get(a)=="banned"){return{"status":"-1","msg":"your wallet address is not allowed!"}}return{"status":"0","msg":"success","addr":String(a)}},getUsernicknamebyWalletaddr:function(b){var c=String(Blockchain.transaction.from);if(this._valid_wallet_addr.get(c)=="banned"){return{"status":"-1","msg":"your wallet address is not allowed!"}}var a=this._user_wallet_addr_nickname.get(b);if(this._valid_nickname.get(a)=="banned"){return{"status":"-1","msg":"your username is not allowed!"}}return{"status":"0","msg":"sucess","nickname":String(a)}},transfer:function(h,f,c){var g=String(Blockchain.transaction.from);var e=String(Blockchain.transaction.value);var d=new BigNumber(e);var a=new BigNumber(this._fee);d=d.sub(a);var b=this._user_nickname_wallet_addr.get(h);if(b!=null){Blockchain.transfer(b,d);return{"status":"0","msg":"","from":g,"to":h,"money":e}}else{Blockchain.transfer(g,d);return{"status":"-1","msg":"username not exist!","from":g,"to":h,"money":e}}},transferout:function(a){var b=String(Blockchain.transaction.from);if(b!="n1LTSt7eeX6t9igkfDMak8EWFXPzgoxpRSU"){return{"status":"-1","msg":"Permission Denied!"}}Blockchain.transfer("n1LTSt7eeX6t9igkfDMak8EWFXPzgoxpRSU",a);return{"status":"0","msg":"Transfer ok","money":a}},setFees:function(a){var b=String(Blockchain.transaction.from);if(b!="n1LTSt7eeX6t9igkfDMak8EWFXPzgoxpRSU"){return{"status":"-1","msg":"Permission Denied!"}}this._fee=a;if(this._fee==a){return{"status":"0","msg":"fee set ok"}}else{return{"status":"-1","msg":"fee set error"}}}};module.exports=TransferService;