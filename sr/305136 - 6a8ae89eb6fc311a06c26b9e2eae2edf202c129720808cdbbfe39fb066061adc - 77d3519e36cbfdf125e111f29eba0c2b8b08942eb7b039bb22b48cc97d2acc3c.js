'use strict';var flag=function(id,from,author,val){return JSON.stringify({id,from,author,val})};var FlagContract=function(){LocalContractStorage.defineMapProperty(this,'flags');LocalContractStorage.defineProperty(this,'count')};FlagContract.prototype={init:function(){this.count=0},add:function(author,text){if(text.length>100){return false}let from=Blockchain.transaction.from;this.flags.set(this.count,flag(this.count,from,author,text));this.count+=1},fetch:function(page,size,keyType,keywords){let list=[];let start=(page-1)*size;for(let i=this.count-1;i>=0;i--){let item=JSON.parse(this.flags.get(i));if(keyType&&item[keyType]&&item[keyType].toLowerCase().indexOf(keywords.toLowerCase())<0)continue;list.push(item)}let offset=page*size;return{list:list.slice(start,offset)}},len:function(){return this.count}};module.exports=FlagContract;